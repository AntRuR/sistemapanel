<?php //á// prin($_GET);if($_GET['ajax']=='1'){		chdir("../../");		include("lib/global.php");	include("lib/conexion.php");	include("lib/mysql3.php");	include("lib/util2.php");	include("lib/webutil2.php");	include("config/tablas.php");	include("lib/sesion.php");	include("lib/playmemory.php");	include("lib/class.phpmailer.php");	define("THEME_PATH","web/templates/".$vars['GENERAL']['template']."/");			include("../web/modulos/common.php");	include("../web/modulos/formularios/formularios.php");}include("lib/simple_html_dom.php");include("config/library.php");	//if($_GET['id']!=''){		$linea=select_fila(							array(								'id','id_cliente','pedido','id_item','id_usuario','id_status','pedido','cuota_inicial','saldo_financiar','separacion','pvpromocion',								'sectorista_nombre','sectorista_email','sectorista_telefono','id_banco','id_sectorista','id_promocion'								),							'tramites_items',							'where id='.$_GET['id'],							0,							array(								'cliente'	=>array('fila'=>array('nombre,apellidos,genero,email,dni','clientes','where id="{id_cliente}"')),								'banco'=>array('fila'=>array('nombre','bancos','where id="{id_banco}"')),								// 'usuario'	=>array('fila'=>array('nombre,apellidos,genero,email,firma','usuarios','where id="{id_usuario}"')),								//'grupo'		=>array('fila'=>array('nombre','productos_grupos','where id="{id_grupo}"')),								//'tipo'		=>array('fila'=>array('nombre','productos_tipo','where id="{id_tipo}"')),								// 'item'		=>array('fila'=>array('nombre,descripcion5','productos_items','where id="{id_item}"')),															// 'item_item'	=>array('fila'=>array('nombre,numero,id_items_tipo','productos_items_items','where id="{id_items_item}"')),															// 'cuenta'	=>array('fila'=>array('nombre,logo,fecha_creacion,dominio','envios_cuentas','where id="{id_cuenta_email}"',0,								// 		array('logo'=>array('archivo'=>array('log_imas','{fecha_creacion}','{logo}')))									// 	)								// ),															// 'sectorista'=>array('fila'=>array('nombre,apellidos,email,telefono','bancos_sectoristas','where id="{id_sectorista}"')),								// 'promocion'=>array('fila'=>array('texto','promociones','where id="{id_promocion}"')),							)													);		// prin($linea);	$styles=render_style();	// $tableProps='width="100%" cellpadding="0" cellspacing="0" border="0" ';	ÏÏ							// $producto['ficha']=fix_ficha($producto['ficha']);		//var_dump($producto);	/**	 * CLIENTE	 */		$pblocks=array();	$pblocks[]=render_logo($linea);	$pblocks[]=render_cliente($linea);		$pedido=json_decode($linea['pedido']);		// prin($linea['pedido']);		// exit();		$pdepartamentos=array();		$pdepositos=array();		$pestacionamientos=array();		$suma=0;		foreach($pedido as $pedi){			switch($pedi->type){				case "departamento":					$pdepartamentos[]=array('id'=>$pedi->id,'price'=>$pedi->price); $suma=$suma+$pedi->price;				break;				case "estacionamiento":					$pestacionamientos[]=array('id'=>$pedi->id,'price'=>$pedi->price); $suma=$suma+$pedi->price;				break;				case "deposito":					$pdepositos[]=array('id'=>$pedi->id,'price'=>$pedi->price); $suma=$suma+$pedi->price;				break;									}		}		foreach($pdepartamentos as $pdep)			$pblocks[]=render_departamentos(extract_departamentos($pdep['id']),$pdep['price']);		foreach($pdepositos as $pdep)			$pblocks[]=render_depositos(extract_depositos($pdep['id']),$pdep['price']);		foreach($pestacionamientos as $pdep)			$pblocks[]=render_estacionamiento(extract_estacionamiento($pdep['id']),$pdep['price']);			$pblocks[]=render_total($linea,$suma);		$pblocks[]=render_vendedor($linea);		// $pblocks[]=render_caracteristicas_inmueble($pdepartamentos['0']);		$pblocks[]=render_caracteristicas_proyecto($linea);		$pblocks[]=render_plano(extract_departamentos($pdepartamentos['0']['id']),$pdepartamentos['0']['price']);		$pblocks[]=render_firma($linea);		// prin($pblocks);		$html=implode("",$pblocks);		// echo $html;		// exit();		// echo '<textarea>'.$html.'</textarea>';		// die();				$Producto=str_replace("\\\"","\"",$html);			if($_SERVER['REQUEST_METHOD']=='POST'){				$CuentasE=select('nombre,email,logo,fecha_creacion,dominio','envios_cuentas','where 1',0,									array('logo'=>array('archivo'=>array('log_imas','{fecha_creacion}','{logo}')))									);				$linea['cuenta']['logo']=($linea['id_grupo']=='4')?$CuentasE['1']['logo']:$CuentasE['0']['logo'];						$unos=between($_POST['msg'],"<!--","-->");				$ID_SPEECH=dato("id","speeches","where nombre='".$unos[1]."'",0);							$insertado_mensaje=insert(array(								'id_grupo'=>$_GET['id'],								'nombre'=>'10',								'paso'=>$_POST['subject'],								'detalle'=>$_POST['msg'],																// 'id_speech'=>$ID_SPEECH,								'fecha_creacion'=>"now()",								'fecha_edicion'=>"now()",									'visibilidad'=>'1',								 ),								 "tramites_subitems",								 0								 );				$email_cliente=enviar_email(							array(							'emails'=>array(											// 'guillermolozan@gmail.com',											$_POST['mailto'],											// $linea['cliente']['email'],											// $linea['usuario']['email'],											// 'wtavara@prodiserv.com',											)							,'Subject'=>$_POST['subject']							,'body'=>$_POST['msg'].$style							,'From'=>'sancherbel@crminmobiliario.info'							,'FromName'=>'San Cherbel' 							,'Logo'=>''							)						);					print_r($email_cliente);				//			print_r($email_cliente['todos']);				exit();			}				//prin($linea);		$tbcampos=array(						'from'		=>array(							'campo'			=> 'from',							'label'			=> 'Desde',							'tipo'			=> 'inp',							'style'			=> 'width:300px;',														'size'			=> '250',								'derecha'		=> '1',							'constante'		=> '0',							'default'		=> 'no-reply@crminmobiliario.info',							'listyle'		=> 'display:none;'						),						'mailto'		=>array(							'campo'			=> 'mailto',							'label'			=> 'Para',							'tipo'			=> 'inp',							'style'			=> 'width:300px;',														'size'			=> '250',								'derecha'		=> '1',							// 'constante'		=> ($_GET['id']=='')?'0':'1',							// 'default'		=> $linea['id_cliente'],							// 'opciones'		=> 'id,nombre;apellidos;email|clientes',						),						'asunto'		=>array(							'campo'			=> 'asunto',							'label'			=> 'Asunto',							'tipo'			=> 'inp',							'style'			=> 'width:400px;',														'size'			=> '250',								'derecha'		=> '1',							'default'		=> ''						),						'texto'			=>array(							'campo'			=> 'texto',							'label'			=> '',							'tipo'			=> 'html',							'style'			=> 'width:750px;height:400px;',							'width'			=> '100px',							'derecha'		=> '1',							//'css'			=> 'table { width:100%; margin-bottom:10px; background:none; } table td, table th { border:0 !important; padding:0px !importat;}',							'default'		=> '',							'botones'		=> 'nombre,texto|tramites_speeches|where 1',							'variables'		=> array(										'ESTIMADO'          =>($linea['cliente']['genero']=='2')?'Estimada':'Estimado',								'SR'                =>($linea['cliente']['genero']=='2')?'Sra.':'Sr.',								//'VENDEDOR_NOMBRE' =>$linea['usuario']['nombre'].' '.$linea['usuario']['apellidos'],								//'VENDEDOR'        =>(($linea['usuario']['genero']=='2')?'la Srta.':'el Sr.')." ".$linea['usuario']['nombre'].' '.$linea['usuario']['apellidos'],								// 'VENDEDOR'          =>$linea['usuario']['nombre'].' '.$linea['usuario']['apellidos'],								//'CLIENTE_NOMBRE'  =>$linea['cliente']['nombre'].' '.$linea['cliente']['apellidos'],								//'CLIENTE'         =>(($linea['cliente']['genero']=='2')?'Srta.':'Sr.')." ".$linea['cliente']['nombre'].' '.$linea['cliente']['apellidos'],								'CLIENTE'           =>strtoupper($linea['cliente']['nombre'].' '.$linea['cliente']['apellidos']),															// 'MODELO'         =>$linea['grupo']['nombre'].' '.$linea['item']['nombre'],																// 'INMUEBLE'          =>$linea['item']['nombre'].' - '.$linea['item_item']['nombre'].' '.$linea['item_item']['numero'],								// 'FICHA'             =>"<span class=\"id_speech\"></span>".str_replace("'","\"",$Producto),									// 'FIRMA'             =>str_replace("'","\"",$linea['usuario']['firma']),							)					),		);		// prin($tbcampos);		//prin($Productos[$linea['id_item']]);	?>	<script type="text/javascript" src="js/ckeditor/ckeditor.js"></script>			<div>		<div class="bloque_content_crear" style="width:800px;" >	    <ul class="formulario">		<?php 		include('formulario_campos.php'); ?>		<li id="linea_crear" class="linea_form " >				<label>&nbsp;</label>		<input type="button" onclick="enviar();" value="Enviar Email" class="btn btn-primary enviar" id="in_submit">		</li>		</ul>	    </div>	    <div class="columna_derecha" id="botones"></div>	    	    <script>		<?php include("formulario_camposjs.php"); ?>		function enviar(){			var msg=CKEDITOR.instances.in_texto.getData();			crear_loading("Enviando");			new Request({url:"base2/apps/enviar_email_tramite.php?id=<?php echo $_GET['id'];?>&ajax=1",method:'post',data:{'msg':msg,'subject':$('in_asunto').value,'mailto':$('in_mailto').value},onSuccess:function(eee){			alert('mensaje enviado');			window.close();			}}).send();				}		function crear_loading(string){			new Element('div', {'id':'loading', 'html': 'cargando','styles': {					position: 'absolute',					'background-color':'#000000',					top: 0,					left: 0,					width: window.getWidth(),					height: window.getHeight(),					filter: 'progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)',					opacity: 0.4,					'z-index': 998				}}).inject($(document.body), 'top');			new Element('div', {'id':'loading_inner', 'html': string+'...','styles': {					position: 'absolute',					'background-color':'#000000',					height: 'auto',					padding:'5px 20px',					width: 140,					'text-align': 'center',					left: 964/2 - 70,					top: window.getHeight()/2 - 20,					'z-index': 999,					'color':'red',					'font-family':'calibri',					'font-size':'20px'				}}).inject($(document.body), 'top');		}		    </script>	</div><script language="JavaScript" type="text/javascript"> 	window.moveTo(0,0); 	window.resizeTo(900,750); </script> 